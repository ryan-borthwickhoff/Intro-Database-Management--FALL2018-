SELECT C.CUSTID, D.CUSTNAME, D.CUSTSEG, COUNT(DISTINCT C.PRODCAT) AS Categories_Purchased, SUM(C.ORDQTY) as Qty_Purchased
FROM
((SELECT *
	FROM(
        ORDERDET A
        INNER JOIN
        PRODUCTS B
        ON A.PRODID = B.PRODID
)) C     
   INNER JOIN
  CUSTOMERS D
  ON C.CUSTID = D.CUSTID
)
GROUP BY C.CUSTID, D.CUSTNAME, D.CUSTSEG
HAVING SUM(C.ORDQTY) > 80 AND COUNT(DISTINCT C.PRODCAT) <>3 AND CUSTSEG IN ('Corporate', 'Small Business')
ORDER BY Categories_Purchased ASC, Qty_Purchased DESC;
